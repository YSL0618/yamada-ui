import{j as r}from"./jsx-runtime-CfatFE5O.js";import{u as se}from"./index-BcE809qD.js";import{r as e}from"./index-ClcD9ViR.js";import{P as oe,b as re}from"./popover-trigger-D8n20qZW.js";import{a as ae}from"./use-component-style-CLSKeq_H.js";import{o as ue}from"./theme-provider-CNI9L2WW.js";import{p as V,f as Q,X as ce,$ as Y,a as Z,h as O,an as le,b as S,c as E,x as ie,aq as me}from"./factory-COau3w21.js";import{u as fe}from"./index-C58se0b8.js";import{f as L}from"./forward-ref-D13m8o2p.js";import{c as de}from"./index-Btt-sfjQ.js";const{DescendantsContextProvider:xe,useDescendant:pe,useDescendants:_e,useDescendantsContext:Me}=de(),[Ce,q]=V({name:"MenuContext",errorMessage:`useMenu returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />"`}),[Le,ve]=V({name:"ContextMenuContext",strict:!1}),[ye,Ie]=V({name:"UpstreamMenuContext",strict:!1}),[be,ee]=V({name:"UpstreamMenuItemContext",strict:!1}),he=u=>{const{styles:o}=ve()??{},[c,m]=ae("Menu",u,{isProcessSkip:!!o,styles:o});let{closeOnBlur:l,closeOnSelect:p=!0,duration:f=.2,initialFocusRef:d,offset:x,placement:I,onClose:b,onOpen:a,...F}=ue(m);const{relatedRef:y,onDownstreamCloseMapRef:_,onUpstreamClose:i}=Ie()??{},{hasDownstreamRef:k,setDownstreamOpen:C}=ee()??{},n=!!y;n?(I??(I="right-start"),x??(x=[-8,8]),l??(l=!1)):I??(I="bottom-start");const h=_e(),[R,v]=e.useState(-1),j=e.useRef(null),U=e.useRef(null),M=e.useRef(new Set([])),H=e.useRef(null),T=e.useRef(new Map),K=e.useCallback(()=>{requestAnimationFrame(()=>{var t;return(t=j.current)==null?void 0:t.focus({preventScroll:!1})})},[]),g=e.useCallback(()=>{const t=setTimeout(()=>{if(d)return;const s=h.enabledFirstValue();s&&v(s.index)});M.current.add(t)},[h,d]),z=e.useCallback(()=>{const t=setTimeout(()=>{if(d)return;const s=h.enabledLastValue();s&&v(s.index)});M.current.add(t)},[h,d]),W=e.useCallback(()=>{a==null||a(),n||K()},[a,n,K]),X=e.useCallback(()=>{b==null||b();for(const t of T.current.values())t()},[b]),A=e.useId(),{isOpen:w,onClose:D,onOpen:P}=se({...u,onClose:X,onOpen:W});return e.useEffect(()=>{const t=_==null?void 0:_.current;return t==null||t.set(A,D),()=>{t==null||t.delete(A)}},[A,D,_]),e.useEffect(()=>{C&&C(w)},[C,w]),e.useEffect(()=>(k&&(k.current=!0),()=>{k&&(k.current=!1)})),Q(()=>{w||v(-1)},[w]),ce(()=>{M.current.forEach(t=>clearTimeout(t)),M.current.clear()}),r.jsx(xe,{value:h,children:r.jsx(ye,{value:{relatedRef:j,onDownstreamCloseMapRef:T,onUpstreamClose:Y(i,D)},children:r.jsx(Ce,{value:{buttonRef:U,closeOnSelect:p,focusedIndex:R,isNested:n,isOpen:w,menuRef:j,requestAnimationFrameId:H,setFocusedIndex:v,styles:c,onClose:D,onFocusFirstItem:g,onFocusLastItem:z,onOpen:P,onUpstreamClose:i},children:r.jsx(oe,{trigger:n?"hover":"click",...F,closeOnBlur:l,closeOnButton:!1,duration:f,initialFocusRef:d,isOpen:w,offset:x,placement:I,relatedRef:y,onClose:D,onOpen:P})})})})};he.__ui__="Menu";const ke=u=>{var o;return me(u)&&!!((o=u.getAttribute("role"))!=null&&o.startsWith("menuitem"))},$=L(({className:u,children:o,closeOnSelect:c,command:m,icon:l,isDisabled:p,isFocusable:f,...d},x)=>{const{closeOnSelect:I,focusedIndex:b,isNested:a,isOpen:F,menuRef:y,requestAnimationFrameId:_,setFocusedIndex:i,styles:k,onClose:C,onUpstreamClose:n}=q(),{onUpstreamRestoreFocus:h}=ee()??{},R=p&&!f,v=e.useRef(null),j=e.useRef(!1),U=e.useRef(()=>{}),{index:M,register:H}=pe({disabled:R}),[T,K]=e.useState(!1),g=M===b,z=e.useCallback(()=>{p||i(M)},[M,p,i]),W=e.useCallback(()=>{p||i(-1)},[i,p]),X=e.useCallback(s=>{if(!ke(s.currentTarget))return;const N=j.current;(c??(!N&&I))&&(C(),n==null||n())},[c,I,C,n]),A=e.useCallback(()=>{i(M)},[i,M]),w=e.useCallback(()=>{var s;(s=v.current)==null||s.focus(),i(M)},[i,M]),D=e.useCallback(s=>{const J={ArrowLeft:a?Y(h,C):void 0}[s.key];J&&(s.preventDefault(),s.stopPropagation(),J())},[h,C,a]),P=fe({focusOnClick:!1,...d,ref:Z(H,v,x),isDisabled:p,isFocusable:f,onClick:O(d.onClick,X),onFocus:O(d.onFocus,A),onKeyDown:O(d.onKeyDown,D,U.current),onMouseLeave:O(d.onMouseLeave,W),onMouseOver:O(d.onMouseOver,z)});Q(()=>{if(!F)return;const s=_.current;return g&&!R&&v.current?(s&&cancelAnimationFrame(s),_.current=requestAnimationFrame(()=>{var N;(N=v.current)==null||N.focus({preventScroll:!0}),_.current=null})):y.current&&!le(y.current)&&y.current.focus({preventScroll:!0}),()=>{s&&cancelAnimationFrame(s)}},[g,R,y,F]),o=l||m?r.jsx(S.span,{style:{flex:1},children:o}):o;const t={alignItems:"center",color:"inherit",display:"flex",flex:"0 0 auto",gap:"0.75rem",outline:0,textAlign:"start",textDecoration:"none",userSelect:"none",width:"100%",...k.item};return r.jsx(be,{value:{hasDownstreamRef:j,setDownstreamOpen:K,onKeyDownRef:U,onUpstreamRestoreFocus:w},children:r.jsxs(S.div,{...P,...T?{"data-active":""}:{},className:E("ui-menu__item",u),role:"menuitem",tabIndex:g?0:-1,__css:t,children:[l?r.jsx(B,{children:l}):null,o,m?r.jsx(G,{children:m}):null]})})});$.displayName="MenuItem";$.__ui__="MenuItem";const ne=L(({className:u,children:o,closeOnSelect:c=!1,icon:m,isChecked:l,...p},f)=>r.jsxs($,{ref:f,className:E("ui-menu__item--option",u),"aria-checked":ie(l),closeOnSelect:c,...p,children:[m!==null?r.jsx(B,{opacity:l?1:0,children:m||r.jsx(Re,{})}):null,o]}));ne.displayName="MenuOptionItem";ne.__ui__="MenuOptionItem";const B=L(({className:u,...o},c)=>{const{styles:m}=q(),l={alignItems:"center",display:"inline-flex",flexShrink:0,fontSize:"0.85em",justifyContent:"center",...m.icon};return r.jsx(S.span,{ref:c,className:E("ui-menu__item__icon",u),"aria-hidden":!0,__css:l,...o})});B.displayName="MenuIcon";B.__ui__="MenuIcon";const G=L(({className:u,...o},c)=>{const{styles:m}=q(),l={...m.command};return r.jsx(S.span,{ref:c,className:E("ui-menu__item__command",u),__css:l,...o})});G.displayName="MenuCommand";G.__ui__="MenuCommand";const Re=()=>r.jsx("svg",{height:"1em",viewBox:"0 0 14 14",width:"1em",children:r.jsx("polygon",{fill:"currentColor",points:"5.5 11.9993304 14 3.49933039 12.5 2 5.5 8.99933039 1.5 4.9968652 0 6.49933039"})}),te=L(({className:u,children:o,contentProps:c,...m},l)=>{var C;const{buttonRef:p,focusedIndex:f,menuRef:d,setFocusedIndex:x,styles:I,onClose:b}=q(),a=Me(),F=e.useCallback(()=>{const n=a.enabledNextValue(f);n&&x(n.index)},[a,f,x]),y=e.useCallback(()=>{const n=a.enabledPrevValue(f);n&&x(n.index)},[a,f,x]),_=e.useCallback(()=>{const n=a.enabledFirstValue();n&&x(n.index)},[a,x]),i=e.useCallback(()=>{const n=a.enabledLastValue();n&&x(n.index)},[a,x]),k=e.useCallback(n=>{const R={ArrowDown:f===-1?_:F,ArrowUp:f===-1?i:y,End:i,Escape:b,Home:_,Tab:v=>v.preventDefault()}[n.key];R&&(n.preventDefault(),R(n))},[f,b,_,i,F,y]);return r.jsx(re,{as:"div",className:"ui-menu__content",__css:{...I.content},...c,onKeyDown:O(c==null?void 0:c.onKeyDown,k),children:r.jsx(S.div,{ref:Z(d,l),className:E("ui-menu__list",u),"aria-labelledby":(C=p.current)==null?void 0:C.id,role:"menu",tabIndex:-1,__css:{...I.list},...m,children:o})})});te.displayName="MenuList";te.__ui__="MenuList";export{Le as C,B as M,q as a,he as b,te as c,$ as d,ve as e,ne as f,ee as u};
