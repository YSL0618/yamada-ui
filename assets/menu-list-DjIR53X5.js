import{j as c}from"./extends-CwFRzn3r.js";import{u as $}from"./index-Dbjktjet.js";import{r as e}from"./index-BwDkhjyp.js";import{P as ee,b as ne}from"./popover-trigger-C4B9Wa4t.js";import{a as te}from"./use-component-style-DhRiPQIp.js";import{o as se}from"./theme-provider-Cr3m0r8P.js";import{p as q,f as J,W as oe,_ as Q,a as X,h as O,am as re,b as L,c as N,w as ce,ap as ae}from"./factory-DBrfn43w.js";import{u as ue}from"./index-BD-dMYlD.js";import{f as T}from"./forward-ref-BWI-Phbn.js";import{c as le}from"./index-ByFQ-olM.js";const{DescendantsContextProvider:ie,useDescendant:fe,useDescendants:me,useDescendantsContext:de}=le(),[xe,B]=q({name:"MenuContext",errorMessage:`useMenu returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />"`}),[Se,pe]=q({name:"ContextMenuContext",strict:!1}),[Ce,Me]=q({name:"UpstreamMenuContext",strict:!1}),[ve,Y]=q({name:"UpstreamMenuItemContext",strict:!1}),Ee=a=>{const{styles:o}=pe()??{},[u,f]=te("Menu",a,{isProcessSkip:!!o,styles:o});let{closeOnBlur:l,closeOnSelect:r=!0,duration:y=.2,initialFocusRef:t,offset:w,placement:b,onClose:i,onOpen:M,...R}=se(f);const{relatedRef:C,onDownstreamCloseMapRef:p,onUpstreamClose:m}=Me()??{},{hasDownstreamRef:n,setDownstreamOpen:k}=Y()??{},d=!!C;d?(b??(b="right-start"),w??(w=[-8,8]),l??(l=!1)):b??(b="bottom-start");const v=me(),[A,_]=e.useState(-1),g=e.useRef(null),F=e.useRef(new Set([])),h=e.useRef(null),K=e.useRef(new Map),P=e.useCallback(()=>{requestAnimationFrame(()=>{var s;return(s=g.current)==null?void 0:s.focus({preventScroll:!1})})},[]),H=e.useCallback(()=>{const s=setTimeout(()=>{if(t)return;const j=v.enabledFirstValue();j&&_(j.index)});F.current.add(s)},[v,t]),S=e.useCallback(()=>{const s=setTimeout(()=>{if(t)return;const j=v.enabledLastValue();j&&_(j.index)});F.current.add(s)},[v,t]),W=e.useCallback(()=>{M==null||M(),d||P()},[M,d,P]),z=e.useCallback(()=>{i==null||i();for(const s of K.current.values())s()},[i]),E=e.useId(),{isOpen:I,onClose:D,onOpen:V}=$({...a,onClose:z,onOpen:W});return e.useEffect(()=>{const s=p==null?void 0:p.current;return s==null||s.set(E,D),()=>{s==null||s.delete(E)}},[E,D,p]),e.useEffect(()=>{k&&k(I)},[k,I]),e.useEffect(()=>(n&&(n.current=!0),()=>{n&&(n.current=!1)})),J(()=>{I||_(-1)},[I]),oe(()=>{F.current.forEach(s=>clearTimeout(s)),F.current.clear()}),c.jsx(ie,{value:v,children:c.jsx(Ce,{value:{relatedRef:g,onDownstreamCloseMapRef:K,onUpstreamClose:Q(m,D)},children:c.jsx(xe,{value:{closeOnSelect:r,focusedIndex:A,isNested:d,isOpen:I,menuRef:g,requestAnimationFrameId:h,setFocusedIndex:_,styles:u,onClose:D,onFocusFirstItem:H,onFocusLastItem:S,onOpen:V,onUpstreamClose:m},children:c.jsx(ee,{trigger:d?"hover":"click",...R,closeOnBlur:l,closeOnButton:!1,duration:y,initialFocusRef:t,isOpen:I,offset:w,placement:b,relatedRef:C,onClose:D,onOpen:V})})})})},be=a=>{var o;return ae(a)&&!!((o=a.getAttribute("role"))!=null&&o.startsWith("menuitem"))},ke=T(({className:a,children:o,closeOnSelect:u,command:f,icon:l,isDisabled:r,isFocusable:y,...t},w)=>{const{closeOnSelect:b,focusedIndex:i,isNested:M,isOpen:R,menuRef:C,requestAnimationFrameId:p,setFocusedIndex:m,styles:n,onClose:k,onUpstreamClose:d}=B(),{onUpstreamRestoreFocus:v}=Y()??{},A=r&&!y,_=e.useRef(null),g=e.useRef(!1),F=e.useRef(()=>{}),{index:h,register:K}=fe({disabled:A}),[P,H]=e.useState(!1),S=h===i,W=e.useCallback(()=>{r||m(h)},[h,r,m]),z=e.useCallback(()=>{r||m(-1)},[m,r]),E=e.useCallback(x=>{if(!be(x.currentTarget))return;const U=g.current;(u??(!U&&b))&&(k(),d==null||d())},[u,b,k,d]),I=e.useCallback(()=>{m(h)},[m,h]),D=e.useCallback(()=>{var x;(x=_.current)==null||x.focus(),m(h)},[m,h]),V=e.useCallback(x=>{const G={ArrowLeft:M?Q(v,k):void 0}[x.key];G&&(x.preventDefault(),x.stopPropagation(),G())},[v,k,M]),s=ue({focusOnClick:!1,...t,ref:X(K,_,w),isDisabled:r,isFocusable:y,onClick:O(t.onClick,E),onFocus:O(t.onFocus,I),onKeyDown:O(t.onKeyDown,V,F.current),onMouseLeave:O(t.onMouseLeave,z),onMouseOver:O(t.onMouseOver,W)});J(()=>{if(!R)return;const x=p.current;return S&&!A&&_.current?(x&&cancelAnimationFrame(x),p.current=requestAnimationFrame(()=>{var U;(U=_.current)==null||U.focus({preventScroll:!0}),p.current=null})):C.current&&!re(C.current)&&C.current.focus({preventScroll:!0}),()=>{x&&cancelAnimationFrame(x)}},[S,A,C,R]),o=l||f?c.jsx(L.span,{style:{flex:1},children:o}):o;const j={alignItems:"center",color:"inherit",display:"flex",flex:"0 0 auto",gap:"0.75rem",outline:0,textAlign:"start",textDecoration:"none",userSelect:"none",width:"100%",...n.item};return c.jsx(ve,{value:{hasDownstreamRef:g,setDownstreamOpen:H,onKeyDownRef:F,onUpstreamRestoreFocus:D},children:c.jsxs(L.li,{...s,...P?{"data-active":""}:{},className:N("ui-menu__item",a),role:"menuitem",tabIndex:S?0:-1,__css:j,children:[l?c.jsx(Z,{children:l}):null,o,f?c.jsx(_e,{children:f}):null]})})}),Ue=T(({className:a,children:o,closeOnSelect:u=!1,icon:f,isChecked:l,...r},y)=>c.jsxs(ke,{ref:y,className:N("ui-menu__item--option",a),"aria-checked":ce(l),closeOnSelect:u,...r,children:[f!==null?c.jsx(Z,{opacity:l?1:0,children:f||c.jsx(he,{})}):null,o]})),Z=T(({className:a,...o},u)=>{const{styles:f}=B(),l={alignItems:"center",display:"inline-flex",flexShrink:0,fontSize:"0.85em",justifyContent:"center",...f.icon};return c.jsx(L.span,{ref:u,className:N("ui-menu__item__icon",a),__css:l,...o})}),_e=T(({className:a,...o},u)=>{const{styles:f}=B(),l={...f.command};return c.jsx(L.span,{ref:u,className:N("ui-menu__item__command",a),__css:l,...o})}),he=()=>c.jsx("svg",{height:"1em",viewBox:"0 0 14 14",width:"1em",children:c.jsx("polygon",{fill:"currentColor",points:"5.5 11.9993304 14 3.49933039 12.5 2 5.5 8.99933039 1.5 4.9968652 0 6.49933039"})}),Le=T(({className:a,children:o,contentProps:u,...f},l)=>{const{focusedIndex:r,menuRef:y,setFocusedIndex:t,styles:w,onClose:b}=B(),i=de(),M=e.useCallback(()=>{const n=i.enabledNextValue(r);n&&t(n.index)},[i,r,t]),R=e.useCallback(()=>{const n=i.enabledPrevValue(r);n&&t(n.index)},[i,r,t]),C=e.useCallback(()=>{const n=i.enabledFirstValue();n&&t(n.index)},[i,t]),p=e.useCallback(()=>{const n=i.enabledLastValue();n&&t(n.index)},[i,t]),m=e.useCallback(n=>{const d={ArrowDown:r===-1?C:M,ArrowUp:r===-1?p:R,End:p,Escape:b,Home:C,Tab:v=>v.preventDefault()}[n.key];d&&(n.preventDefault(),d(n))},[r,b,C,p,M,R]);return c.jsx(ne,{as:"div",className:"ui-menu__content",__css:{...w.content},...u,onKeyDown:O(u==null?void 0:u.onKeyDown,m),children:c.jsx(L.ul,{ref:X(y,l),className:N("ui-menu__list",a),role:"menu",tabIndex:-1,__css:{...w.list},...f,children:o})})});export{Se as C,Z as M,B as a,Ee as b,Le as c,ke as d,pe as e,Ue as f,Y as u};
