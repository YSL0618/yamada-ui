import{j as c}from"./extends-CwFRzn3r.js";import{u as $}from"./index-EJODL346.js";import{r as e}from"./index-BwDkhjyp.js";import{P as ee,b as ne}from"./popover-trigger-EpYwdnAy.js";import{a as te}from"./use-component-style-CLkw4iG2.js";import{o as se}from"./theme-provider-D1j4LEQ9.js";import{o as q,f as G,S as oe,Y as J,a as Q,h as O,ak as re,b as L,c as N,t as ce,an as ae}from"./factory-CB2imrkD.js";import{u as ue}from"./index-LwS2tk1a.js";import{f as T}from"./forward-ref-BWI-Phbn.js";import{c as le}from"./index-D__Mkjvw.js";const{DescendantsContextProvider:ie,useDescendant:fe,useDescendants:me,useDescendantsContext:de}=le(),[xe,B]=q({name:"MenuContext",errorMessage:`useMenu returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />"`}),[Ae,Ce]=q({name:"ContextMenuContext",strict:!1}),[pe,Me]=q({name:"UpstreamMenuContext",strict:!1}),[ve,X]=q({name:"UpstreamMenuItemContext",strict:!1}),Ee=a=>{const{styles:o}=Ce()??{},[u,f]=te("Menu",a,{isProcessSkip:!!o,styles:o});let{closeOnBlur:l,closeOnSelect:r=!0,duration:I=.2,initialFocusRef:t,offset:w,placement:k,onClose:i,onOpen:M,...R}=se(f);const{relatedRef:p,onDownstreamCloseMapRef:C,onUpstreamClose:m}=Me()??{},{hasDownstreamRef:n,setDownstreamOpen:b}=X()??{},d=!!p;d?(k??(k="right-start"),w??(w=[-8,8]),l??(l=!1)):k??(k="bottom-start");const v=me(),[S,h]=e.useState(-1),g=e.useRef(null),F=e.useRef(new Set([])),y=e.useRef(null),K=e.useRef(new Map),P=e.useCallback(()=>{requestAnimationFrame(()=>{var s;return(s=g.current)==null?void 0:s.focus({preventScroll:!1})})},[]),H=e.useCallback(()=>{const s=setTimeout(()=>{if(t)return;const j=v.enabledFirstValue();j&&h(j.index)});F.current.add(s)},[v,t]),A=e.useCallback(()=>{const s=setTimeout(()=>{if(t)return;const j=v.enabledLastValue();j&&h(j.index)});F.current.add(s)},[v,t]),z=e.useCallback(()=>{M==null||M(),d||P()},[M,d,P]),W=e.useCallback(()=>{i==null||i();for(const s of K.current.values())s()},[i]),E=e.useId(),{isOpen:_,onClose:D,onOpen:V}=$({...a,onClose:W,onOpen:z});return e.useEffect(()=>{const s=C==null?void 0:C.current;return s==null||s.set(E,D),()=>{s==null||s.delete(E)}},[E,D,C]),e.useEffect(()=>{b&&b(_)},[b,_]),e.useEffect(()=>(n&&(n.current=!0),()=>{n&&(n.current=!1)})),G(()=>{_||h(-1)},[_]),oe(()=>{F.current.forEach(s=>clearTimeout(s)),F.current.clear()}),c.jsx(ie,{value:v,children:c.jsx(pe,{value:{relatedRef:g,onDownstreamCloseMapRef:K,onUpstreamClose:J(m,D)},children:c.jsx(xe,{value:{closeOnSelect:r,focusedIndex:S,isNested:d,isOpen:_,menuRef:g,requestAnimationFrameId:y,setFocusedIndex:h,styles:u,onClose:D,onFocusFirstItem:H,onFocusLastItem:A,onOpen:V,onUpstreamClose:m},children:c.jsx(ee,{trigger:d?"hover":"click",...R,closeOnBlur:l,closeOnButton:!1,duration:I,initialFocusRef:t,isOpen:_,offset:w,placement:k,relatedRef:p,onClose:D,onOpen:V})})})})},ke=a=>{var o;return ae(a)&&!!((o=a.getAttribute("role"))!=null&&o.startsWith("menuitem"))},be=T(({className:a,children:o,closeOnSelect:u,command:f,icon:l,isDisabled:r,isFocusable:I,...t},w)=>{const{closeOnSelect:k,focusedIndex:i,isNested:M,isOpen:R,menuRef:p,requestAnimationFrameId:C,setFocusedIndex:m,styles:n,onClose:b,onUpstreamClose:d}=B(),{onUpstreamRestoreFocus:v}=X()??{},S=r&&!I,h=e.useRef(null),g=e.useRef(!1),F=e.useRef(()=>{}),{index:y,register:K}=fe({disabled:S}),[P,H]=e.useState(!1),A=y===i,z=e.useCallback(()=>{r||m(y)},[y,r,m]),W=e.useCallback(()=>{r||m(-1)},[m,r]),E=e.useCallback(x=>{if(!ke(x.currentTarget))return;const U=g.current;(u??(!U&&k))&&(b(),d==null||d())},[u,k,b,d]),_=e.useCallback(()=>{m(y)},[m,y]),D=e.useCallback(()=>{var x;(x=h.current)==null||x.focus(),m(y)},[m,y]),V=e.useCallback(x=>{const Y={ArrowLeft:M?J(v,b):void 0}[x.key];Y&&(x.preventDefault(),x.stopPropagation(),Y())},[v,b,M]),s=ue({focusOnClick:!1,...t,ref:Q(K,h,w),isDisabled:r,isFocusable:I,onClick:O(t.onClick,E),onFocus:O(t.onFocus,_),onKeyDown:O(t.onKeyDown,V,F.current),onMouseLeave:O(t.onMouseLeave,W),onMouseOver:O(t.onMouseOver,z)});G(()=>{if(!R)return;const x=C.current;return A&&!S&&h.current?(x&&cancelAnimationFrame(x),C.current=requestAnimationFrame(()=>{var U;(U=h.current)==null||U.focus({preventScroll:!0}),C.current=null})):p.current&&!re(p.current)&&p.current.focus({preventScroll:!0}),()=>{x&&cancelAnimationFrame(x)}},[A,S,p,R]),o=l||f?c.jsx(L.span,{style:{flex:1},children:o}):o;const j={alignItems:"center",color:"inherit",display:"flex",flex:"0 0 auto",gap:"0.75rem",outline:0,textAlign:"start",textDecoration:"none",userSelect:"none",width:"100%",...n.item};return c.jsx(ve,{value:{hasDownstreamRef:g,setDownstreamOpen:H,onKeyDownRef:F,onUpstreamRestoreFocus:D},children:c.jsxs(L.li,{...s,...P?{"data-active":""}:{},className:N("ui-menu__item",a),role:"menuitem",tabIndex:A?0:-1,__css:j,children:[l?c.jsx(Z,{children:l}):null,o,f?c.jsx(he,{children:f}):null]})})}),Ue=T(({className:a,children:o,closeOnSelect:u=!1,icon:f,isChecked:l,...r},I)=>c.jsxs(be,{ref:I,className:N("ui-menu__item--option",a),"aria-checked":ce(l),closeOnSelect:u,...r,children:[f!==null?c.jsx(Z,{opacity:l?1:0,children:f||c.jsx(ye,{})}):null,o]})),Z=T(({className:a,...o},u)=>{const{styles:f}=B(),l={alignItems:"center",display:"inline-flex",flexShrink:0,fontSize:"0.85em",justifyContent:"center",...f.icon};return c.jsx(L.span,{ref:u,className:N("ui-menu__item__icon",a),__css:l,...o})}),he=T(({className:a,...o},u)=>{const{styles:f}=B(),l={...f.command};return c.jsx(L.span,{ref:u,className:N("ui-menu__item__command",a),__css:l,...o})}),ye=()=>c.jsx("svg",{height:"1em",viewBox:"0 0 14 14",width:"1em",children:c.jsx("polygon",{fill:"currentColor",points:"5.5 11.9993304 14 3.49933039 12.5 2 5.5 8.99933039 1.5 4.9968652 0 6.49933039"})}),Le=T(({className:a,children:o,contentProps:u,...f},l)=>{const{focusedIndex:r,menuRef:I,setFocusedIndex:t,styles:w,onClose:k}=B(),i=de(),M=e.useCallback(()=>{const n=i.enabledNextValue(r);n&&t(n.index)},[i,r,t]),R=e.useCallback(()=>{const n=i.enabledPrevValue(r);n&&t(n.index)},[i,r,t]),p=e.useCallback(()=>{const n=i.enabledFirstValue();n&&t(n.index)},[i,t]),C=e.useCallback(()=>{const n=i.enabledLastValue();n&&t(n.index)},[i,t]),m=e.useCallback(n=>{const d={ArrowDown:r===-1?p:M,ArrowUp:r===-1?C:R,End:C,Escape:k,Home:p,Tab:v=>v.preventDefault()}[n.key];d&&(n.preventDefault(),d(n))},[r,k,p,C,M,R]);return c.jsx(ne,{as:"div",className:"ui-menu__content",__css:{...w.content},...u,onKeyDown:O(u==null?void 0:u.onKeyDown,m),children:c.jsx(L.ul,{ref:Q(I,l),className:N("ui-menu__list",a),role:"menu",tabIndex:-1,__css:{...w.list},...f,children:o})})});export{Ae as C,Z as M,B as a,Ee as b,Le as c,be as d,Ce as e,Ue as f,X as u};
