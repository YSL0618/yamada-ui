import{j as c}from"./extends-CwFRzn3r.js";import{u as $}from"./index--DMNeOYf.js";import{r as e}from"./index-BwDkhjyp.js";import{P as ee,b as ne}from"./popover-trigger-D9NiKBlG.js";import{a as te}from"./use-component-style-BfdzvKeB.js";import{o as se}from"./theme-provider-D6YJ9wXo.js";import{o as q,f as G,U as oe,Y as J,a as Q,h as O,ag as re,b as L,c as N,t as ce,aP as ae}from"./factory-zMrA9M4D.js";import{u as ue}from"./index-DDPoa15D.js";import{f as P}from"./forward-ref-BWI-Phbn.js";import{c as le}from"./index-CyIlvs5K.js";const{DescendantsContextProvider:ie,useDescendant:fe,useDescendants:me,useDescendantsContext:de}=le(),[xe,B]=q({name:"MenuContext",errorMessage:`useMenu returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />"`}),[Se,pe]=q({name:"ContextMenuContext",strict:!1}),[Ce,Me]=q({name:"UpstreamMenuContext",strict:!1}),[ve,X]=q({name:"UpstreamMenuItemContext",strict:!1}),Ue=a=>{const{styles:o}=pe()??{},[u,f]=te("Menu",a,{isProcessSkip:!!o,styles:o});let{closeOnBlur:l,closeOnSelect:r=!0,duration:I=.2,initialFocusRef:t,offset:w,placement:b,onClose:i,onOpen:M,...R}=se(f);const{relatedRef:C,onDownstreamCloseMapRef:p,onUpstreamClose:m}=Me()??{},{hasDownstreamRef:n,setDownstreamOpen:k}=X()??{},d=!!C;d?(b??(b="right-start"),w??(w=[-8,8]),l??(l=!1)):b??(b="bottom-start");const v=me(),[A,h]=e.useState(-1),g=e.useRef(null),F=e.useRef(new Set([])),y=e.useRef(null),T=e.useRef(new Map),K=e.useCallback(()=>{requestAnimationFrame(()=>{var s;return(s=g.current)==null?void 0:s.focus({preventScroll:!1})})},[]),H=e.useCallback(()=>{const s=setTimeout(()=>{if(t)return;const j=v.enabledFirstValue();j&&h(j.index)});F.current.add(s)},[v,t]),S=e.useCallback(()=>{const s=setTimeout(()=>{if(t)return;const j=v.enabledLastValue();j&&h(j.index)});F.current.add(s)},[v,t]),z=e.useCallback(()=>{M==null||M(),d||K()},[M,d,K]),W=e.useCallback(()=>{i==null||i();for(const s of T.current.values())s()},[i]),U=e.useId(),{isOpen:_,onClose:D,onOpen:V}=$({...a,onClose:W,onOpen:z});return e.useEffect(()=>{const s=p==null?void 0:p.current;return s==null||s.set(U,D),()=>{s==null||s.delete(U)}},[U,D,p]),e.useEffect(()=>{k&&k(_)},[k,_]),e.useEffect(()=>(n&&(n.current=!0),()=>{n&&(n.current=!1)})),G(()=>{_||h(-1)},[_]),oe(()=>{F.current.forEach(s=>clearTimeout(s)),F.current.clear()}),c.jsx(ie,{value:v,children:c.jsx(Ce,{value:{relatedRef:g,onDownstreamCloseMapRef:T,onUpstreamClose:J(m,D)},children:c.jsx(xe,{value:{closeOnSelect:r,focusedIndex:A,isNested:d,isOpen:_,menuRef:g,requestAnimationFrameId:y,setFocusedIndex:h,styles:u,onClose:D,onFocusFirstItem:H,onFocusLastItem:S,onOpen:V,onUpstreamClose:m},children:c.jsx(ee,{trigger:d?"hover":"click",...R,closeOnBlur:l,closeOnButton:!1,duration:I,initialFocusRef:t,isOpen:_,offset:w,placement:b,relatedRef:C,onClose:D,onOpen:V})})})})},be=a=>{var o;return ae(a)&&!!((o=a.getAttribute("role"))!=null&&o.startsWith("menuitem"))},ke=P(({className:a,children:o,closeOnSelect:u,command:f,icon:l,isDisabled:r,isFocusable:I,...t},w)=>{const{closeOnSelect:b,focusedIndex:i,isNested:M,isOpen:R,menuRef:C,requestAnimationFrameId:p,setFocusedIndex:m,styles:n,onClose:k,onUpstreamClose:d}=B(),{onUpstreamRestoreFocus:v}=X()??{},A=r&&!I,h=e.useRef(null),g=e.useRef(!1),F=e.useRef(()=>{}),{index:y,register:T}=fe({disabled:A}),[K,H]=e.useState(!1),S=y===i,z=e.useCallback(()=>{r||m(y)},[y,r,m]),W=e.useCallback(()=>{r||m(-1)},[m,r]),U=e.useCallback(x=>{if(!be(x.currentTarget))return;const E=g.current;(u??(!E&&b))&&(k(),d==null||d())},[u,b,k,d]),_=e.useCallback(()=>{m(y)},[m,y]),D=e.useCallback(()=>{var x;(x=h.current)==null||x.focus(),m(y)},[m,y]),V=e.useCallback(x=>{const Y={ArrowLeft:M?J(v,k):void 0}[x.key];Y&&(x.preventDefault(),x.stopPropagation(),Y())},[v,k,M]),s=ue({focusOnClick:!1,...t,ref:Q(T,h,w),isDisabled:r,isFocusable:I,onClick:O(t.onClick,U),onFocus:O(t.onFocus,_),onKeyDown:O(t.onKeyDown,V,F.current),onMouseLeave:O(t.onMouseLeave,W),onMouseOver:O(t.onMouseOver,z)});G(()=>{if(!R)return;const x=p.current;return S&&!A&&h.current?(x&&cancelAnimationFrame(x),p.current=requestAnimationFrame(()=>{var E;(E=h.current)==null||E.focus({preventScroll:!0}),p.current=null})):C.current&&!re(C.current)&&C.current.focus({preventScroll:!0}),()=>{x&&cancelAnimationFrame(x)}},[S,A,C,R]),o=l||f?c.jsx(L.span,{style:{flex:1},children:o}):o;const j={alignItems:"center",color:"inherit",display:"flex",flex:"0 0 auto",gap:"0.75rem",outline:0,textAlign:"start",textDecoration:"none",userSelect:"none",width:"100%",...n.item};return c.jsx(ve,{value:{hasDownstreamRef:g,setDownstreamOpen:H,onKeyDownRef:F,onUpstreamRestoreFocus:D},children:c.jsxs(L.li,{...s,...K?{"data-active":""}:{},className:N("ui-menu__item",a),role:"menuitem",tabIndex:S?0:-1,__css:j,children:[l?c.jsx(Z,{children:l}):null,o,f?c.jsx(he,{children:f}):null]})})}),Ee=P(({className:a,children:o,closeOnSelect:u=!1,icon:f,isChecked:l,...r},I)=>c.jsxs(ke,{ref:I,className:N("ui-menu__item--option",a),"aria-checked":ce(l),closeOnSelect:u,...r,children:[f!==null?c.jsx(Z,{opacity:l?1:0,children:f||c.jsx(ye,{})}):null,o]})),Z=P(({className:a,...o},u)=>{const{styles:f}=B(),l={alignItems:"center",display:"inline-flex",flexShrink:0,fontSize:"0.85em",justifyContent:"center",...f.icon};return c.jsx(L.span,{ref:u,className:N("ui-menu__item__icon",a),__css:l,...o})}),he=P(({className:a,...o},u)=>{const{styles:f}=B(),l={...f.command};return c.jsx(L.span,{ref:u,className:N("ui-menu__item__command",a),__css:l,...o})}),ye=()=>c.jsx("svg",{height:"1em",viewBox:"0 0 14 14",width:"1em",children:c.jsx("polygon",{fill:"currentColor",points:"5.5 11.9993304 14 3.49933039 12.5 2 5.5 8.99933039 1.5 4.9968652 0 6.49933039"})}),Le=P(({className:a,children:o,contentProps:u,...f},l)=>{const{focusedIndex:r,menuRef:I,setFocusedIndex:t,styles:w,onClose:b}=B(),i=de(),M=e.useCallback(()=>{const n=i.enabledNextValue(r);n&&t(n.index)},[i,r,t]),R=e.useCallback(()=>{const n=i.enabledPrevValue(r);n&&t(n.index)},[i,r,t]),C=e.useCallback(()=>{const n=i.enabledFirstValue();n&&t(n.index)},[i,t]),p=e.useCallback(()=>{const n=i.enabledLastValue();n&&t(n.index)},[i,t]),m=e.useCallback(n=>{const d={ArrowDown:r===-1?C:M,ArrowUp:r===-1?p:R,End:p,Escape:b,Home:C,Tab:v=>v.preventDefault()}[n.key];d&&(n.preventDefault(),d(n))},[r,b,C,p,M,R]);return c.jsx(ne,{as:"div",className:"ui-menu__content",__css:{...w.content},...u,onKeyDown:O(u==null?void 0:u.onKeyDown,m),children:c.jsx(L.ul,{ref:Q(I,l),className:N("ui-menu__list",a),role:"menu",tabIndex:-1,__css:{...w.list},...f,children:o})})});export{Se as C,Z as M,B as a,Ue as b,Le as c,ke as d,pe as e,Ee as f,X as u};
