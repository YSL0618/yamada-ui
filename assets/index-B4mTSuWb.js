import{r as m}from"./index-BwDkhjyp.js";import{b,i as K,g as j}from"./event-wx3HPSqP.js";import{u as U,K as G,F as I}from"./factory-BgMvz7NM.js";const J=e=>{const t=m.useRef(null);return t.current=e,t},A=1/60*1e3,Q=typeof performance<"u"?()=>performance.now():()=>Date.now(),C=typeof window<"u"?e=>window.requestAnimationFrame(e):e=>setTimeout(()=>e(Q()),A);function X(e){let t=[],r=[],n=0,o=!1,a=!1;const c=new WeakSet,f={schedule:(s,i=!1,u=!1)=>{const l=u&&o,d=l?t:r;return i&&c.add(s),d.indexOf(s)===-1&&(d.push(s),l&&o&&(n=t.length)),s},cancel:s=>{const i=r.indexOf(s);i!==-1&&r.splice(i,1),c.delete(s)},process:s=>{if(o){a=!0;return}if(o=!0,[t,r]=[r,t],r.length=0,n=t.length,n)for(let i=0;i<n;i++){const u=t[i];u(s),c.has(u)&&(f.schedule(u),e())}o=!1,a&&(a=!1,f.process(s))}};return f}const Y=40;let S=!0,g=!1,F=!1;const x={delta:0,timestamp:0},y=["read","update","preRender","render","postRender"],v=y.reduce((e,t)=>(e[t]=X(()=>g=!0),e),{}),Z=y.reduce((e,t)=>{const r=v[t];return e[t]=(n,o=!1,a=!1)=>(g||k(),r.schedule(n,o,a)),e},{}),_=y.reduce((e,t)=>(e[t]=v[t].cancel,e),{});y.reduce((e,t)=>(e[t]=()=>v[t].process(x),e),{});const $=e=>v[e].process(x),L=e=>{g=!1,x.delta=S?A:Math.max(Math.min(e-x.timestamp,Y),1),x.timestamp=e,F=!0,y.forEach($),F=!1,g&&(S=!1,C(L))},k=()=>{g=!0,S=!0,F||C(L)},H=()=>x,O=(e,t)=>({x:e.x-t.x,y:e.y-t.y}),R=(e,t)=>({point:e.point,delta:O(e.point,t[t.length-1]),offset:O(e.point,t[0]),velocity:te(t,.1)}),ee=e=>e*1e3,te=(e,t)=>{if(e.length<2)return{x:0,y:0};let r=e.length-1,n=null;const o=e[e.length-1];for(;r>=0&&(n=e[r],!(o.timestamp-n.timestamp>ee(t)));)r--;if(!n)return{x:0,y:0};const a=(o.timestamp-n.timestamp)/1e3;if(a===0)return{x:0,y:0};const c={x:(o.x-n.x)/a,y:(o.y-n.y)/a};return c.x===1/0&&(c.x=0),c.y===1/0&&(c.y=0),c},ne=(...e)=>t=>e.reduce((r,n)=>n(r),t),D=(e,t)=>Math.abs(e-t),V=e=>"x"in e&&"y"in e,se=(e,t)=>{if(typeof e=="number"&&typeof t=="number")return D(e,t);if(V(e)&&V(t)){const r=D(e.x,t.x),n=D(e.y,t.y);return Math.sqrt(r**2+n**2)}return 0},re=(e,t,r=3)=>{if(K(e))return;const n=e.view??window,o={point:j(e)},{timestamp:a}=H(),{onSessionStart:c,onStart:f,onMove:s,onEnd:i,onSessionEnd:u}=t,l=[{...o.point,timestamp:a}];let d=null,w=null,E=null;e.stopPropagation(),e.preventDefault(),c==null||c(e,R(o,l));const M=()=>{if(!(w&&E))return;const p=R(E,l),h=d!==null,P=se(p.offset,{x:0,y:0})>=r;if(!h&&!P)return;const{timestamp:B}=H();l.push({...p.point,timestamp:B}),h||(f==null||f(w,p),d=w),s==null||s(w,p)},W=(p,h)=>{w=p,E=h,Z.update(M,!0)},T=(p,h)=>{const P=R(h,l);u==null||u(p,P),N(),!(!i||!d)&&(i==null||i(p,P))},q=p=>{t=p};let z=ne(b(n,"pointermove",W),b(n,"pointerup",T),b(n,"pointercancel",T));const N=()=>{z==null||z(),_.update(M)};return{updateHandlers:q,end:N}},le=(e,{onMove:t,onStart:r,onEnd:n,onSessionStart:o,onSessionEnd:a,threshold:c})=>{const f=!!t||!!r||!!n||!!o||!!a,s=m.useRef(null),i=J({onSessionStart:o,onSessionEnd:a,onStart:r,onMove:t,onEnd:(u,l)=>{s.current=null,n==null||n(u,l)}});m.useEffect(()=>{var u;(u=s.current)==null||u.updateHandlers(i.current)}),m.useEffect(()=>{const u=e.current;return!u||!f?void 0:b(u,"pointerdown",d=>{s.current=re(d,i.current,c)})},[e,f,i,c]),m.useEffect(()=>()=>{var u;(u=s.current)==null||u.end(),s.current=null},[])},oe=(e,t)=>{if(!e){t(void 0);return}t({width:e.offsetWidth,height:e.offsetHeight});const r=e.ownerDocument.defaultView??window,n=new r.ResizeObserver(o=>{if(!I(o)||!o.length)return;const[a]=o;let c,f;if("borderBoxSize"in a){const s=a.borderBoxSize,i=I(s)?s[0]:s;c=i.inlineSize,f=i.blockSize}else c=e.offsetWidth,f=e.offsetHeight;t({width:c,height:f})});return n.observe(e,{box:"border-box"}),()=>n.unobserve(e)},ie=(e,t)=>{var o;if(!e||!e.parentElement)return;const r=((o=e.ownerDocument)==null?void 0:o.defaultView)??window,n=new r.MutationObserver(()=>{t()});return n.observe(e.parentElement,{childList:!0}),()=>{n.disconnect()}},ce=({getNodes:e,observeMutation:t=!0})=>{const[r,n]=m.useState([]),[o,a]=m.useState(0);return U(()=>{const c=e(),f=c.map((s,i)=>oe(s,u=>{n(l=>[...l.slice(0,i),u,...l.slice(i+1)])}));if(t){const s=c[0];f.push(ie(s,()=>{a(i=>i+1)}))}return()=>{f.forEach(s=>{s==null||s()})}},[o]),r},pe=e=>{const[t]=ce({observeMutation:!1,getNodes:()=>[G(e)?e.current:e]});return t};export{pe as a,le as b,ce as c,J as u};
