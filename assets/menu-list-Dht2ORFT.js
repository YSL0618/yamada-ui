import{j as c}from"./jsx-runtime-CfatFE5O.js";import{u as ue}from"./index-D4SEQqYY.js";import{r as e}from"./index-ClcD9ViR.js";import{P as ie,b as le}from"./popover-trigger-cRImiVAI.js";import{a as me}from"./use-component-style-fOirb5M1.js";import{o as fe}from"./theme-provider-DSx3k1bh.js";import{y as B,l as ee,a1 as de,a4 as Q,a as ne,h as N,ar as xe,b as T,c as K,d as pe,au as _e}from"./factory-Dfrbb1EY.js";import{u as Me}from"./index-CgNA1xsw.js";import{f as P}from"./forward-ref-D13m8o2p.js";import{c as Ce}from"./index-O1jdRUiZ.js";const{DescendantsContextProvider:ye,useDescendant:be,useDescendants:Ie,useDescendantsContext:ke}=Ce(),[ve,H]=B({name:"MenuContext",errorMessage:`useMenu returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />"`}),[Ve,he]=B({name:"ContextMenuContext",strict:!1}),[Re,we]=B({name:"UpstreamMenuContext",strict:!1}),[Fe,te]=B({name:"UpstreamMenuItemContext",strict:!1}),je=u=>{const{styles:m}=he()??{},[a,p]=me("Menu",u,{isProcessSkip:!!m,styles:m});let{closeOnBlur:f,closeOnSelect:I=!0,duration:t=.2,initialFocusRef:C,offset:o,placement:v,onClose:M,onOpen:i,...S}=fe(p);const{relatedRef:h,onDownstreamCloseMapRef:_,onUpstreamClose:y}=we()??{},{hasDownstreamRef:r,setDownstreamOpen:j}=te()??{},x=!!h;x?(v??(v="right-start"),o??(o=[-8,8]),f??(f=!1)):v??(v="bottom-start");const d=Ie(),[n,R]=e.useState(-1),w=e.useRef(null),W=e.useRef(null),b=e.useRef(new Set([])),E=e.useRef(null),L=e.useRef(new Map),A=e.useCallback(()=>{requestAnimationFrame(()=>{var s;return(s=w.current)==null?void 0:s.focus({preventScroll:!1})})},[]),V=e.useCallback(()=>{const s=setTimeout(()=>{if(C)return;const g=d.enabledFirstValue();g&&R(g.index)});b.current.add(s)},[d,C]),G=e.useCallback(()=>{const s=setTimeout(()=>{if(C)return;const g=d.enabledLastValue();g&&R(g.index)});b.current.add(s)},[d,C]),k=e.useCallback(()=>{i==null||i(),x||A()},[i,x,A]),J=e.useCallback(()=>{M==null||M();for(const s of L.current.values())s()},[M]),D=e.useId(),{isOpen:F,onClose:O,onOpen:q}=ue({...u,onClose:J,onOpen:k});return e.useEffect(()=>{const s=_==null?void 0:_.current;return s==null||s.set(D,O),()=>{s==null||s.delete(D)}},[D,O,_]),e.useEffect(()=>{j&&j(F)},[j,F]),e.useEffect(()=>(r&&(r.current=!0),()=>{r&&(r.current=!1)})),ee(()=>{F||R(-1)},[F]),de(()=>{b.current.forEach(s=>clearTimeout(s)),b.current.clear()}),c.jsx(ye,{value:d,children:c.jsx(Re,{value:{relatedRef:w,onDownstreamCloseMapRef:L,onUpstreamClose:Q(y,O)},children:c.jsx(ve,{value:{buttonRef:W,closeOnSelect:I,focusedIndex:n,isNested:x,isOpen:F,menuRef:w,requestAnimationFrameId:E,setFocusedIndex:R,styles:a,onClose:O,onFocusFirstItem:V,onFocusLastItem:G,onOpen:q,onUpstreamClose:y},children:c.jsx(ie,{trigger:x?"hover":"click",...S,closeOnBlur:f,closeOnButton:!1,duration:t,initialFocusRef:C,isOpen:F,offset:o,placement:v,relatedRef:h,onClose:O,onOpen:q})})})})};je.__ui__="Menu";const De=u=>{var m;return _e(u)&&!!((m=u.getAttribute("role"))!=null&&m.startsWith("menuitem"))},X=P(({id:u,className:m,children:a,closeOnSelect:p,command:f,icon:I,isDisabled:t,isFocusable:C,...o},v)=>{var Z;const{closeOnSelect:M,focusedIndex:i,isNested:S,isOpen:h,menuRef:_,requestAnimationFrameId:y,setFocusedIndex:r,styles:j,onClose:x,onUpstreamClose:d}=H(),{onUpstreamRestoreFocus:n}=te()??{},[R,w]=e.useState(!1),W=e.useId(),b=e.useRef(null),E=e.useRef(!1),L=e.useRef(()=>{});u??(u=W);const A=t&&!C,V=(Z=b.current)==null?void 0:Z.getAttribute("type"),G=V?V==="checkbox"?"menuitemcheckbox":"menuitemradio":"menuitem",{index:k,register:J}=be({disabled:A}),D=k===i,F=e.useCallback(()=>{t||r(k)},[k,t,r]),O=e.useCallback(()=>{t||r(-1)},[r,t]),q=e.useCallback(l=>{if(!De(l.currentTarget))return;const U=E.current;(p??(!U&&M))&&(x(),d==null||d())},[p,M,x,d]),s=e.useCallback(()=>{r(k)},[r,k]),g=e.useCallback(()=>{var l;(l=b.current)==null||l.focus(),r(k)},[r,k]),ce=e.useCallback(l=>{l.key===" "&&(l.key=l.code);const $={ArrowLeft:S?Q(n,x):void 0,Space:E.current?void 0:Q(d,x)}[l.key];$&&(l.preventDefault(),l.stopPropagation(),$())},[S,n,x,d]),ae=Me({clickOnSpace:!1,focusOnClick:!1,...o,ref:ne(J,b,v),isDisabled:t,isFocusable:C,onClick:N(o.onClick,q),onFocus:N(o.onFocus,s),onKeyDown:N(o.onKeyDown,ce,L.current),onMouseLeave:N(o.onMouseLeave,O),onMouseOver:N(o.onMouseOver,F)});ee(()=>{if(!h)return;const l=y.current;return D&&!A&&b.current?(l&&cancelAnimationFrame(l),y.current=requestAnimationFrame(()=>{var U;(U=b.current)==null||U.focus({preventScroll:!0}),y.current=null})):_.current&&!xe(_.current)&&_.current.focus({preventScroll:!0}),()=>{l&&cancelAnimationFrame(l)}},[D,A,_,h]),a=I||f?c.jsx(T.span,{style:{flex:1},children:a}):a;const re={alignItems:"center",color:"inherit",display:"flex",flex:"0 0 auto",gap:"0.75rem",outline:0,textAlign:"start",textDecoration:"none",userSelect:"none",width:"100%",...j.item};return c.jsx(Fe,{value:{hasDownstreamRef:E,setDownstreamOpen:w,onKeyDownRef:L,onUpstreamRestoreFocus:g},children:c.jsxs(T.div,{id:u,className:K("ui-menu__item",m),"data-focus":pe(R),__css:re,...ae,role:G,tabIndex:!R&&D?0:-1,children:[I?c.jsx(z,{children:I}):null,a,f?c.jsx(Y,{children:f}):null]})})});X.displayName="MenuItem";X.__ui__="MenuItem";const se=P(({className:u,children:m,closeOnSelect:a=!1,icon:p,isChecked:f,...I},t)=>c.jsxs(X,{ref:t,className:K("ui-menu__item--option",u),"aria-checked":f,closeOnSelect:a,...I,children:[p!==null?c.jsx(z,{opacity:f?1:0,children:p||c.jsx(Oe,{})}):null,m]}));se.displayName="MenuOptionItem";se.__ui__="MenuOptionItem";const z=P(({className:u,...m},a)=>{const{styles:p}=H(),f={alignItems:"center",display:"inline-flex",flexShrink:0,fontSize:"0.85em",justifyContent:"center",...p.icon};return c.jsx(T.span,{ref:a,className:K("ui-menu__item__icon",u),"aria-hidden":!0,__css:f,...m})});z.displayName="MenuIcon";z.__ui__="MenuIcon";const Y=P(({className:u,...m},a)=>{const{styles:p}=H(),f={...p.command};return c.jsx(T.span,{ref:a,className:K("ui-menu__item__command",u),__css:f,...m})});Y.displayName="MenuCommand";Y.__ui__="MenuCommand";const Oe=()=>c.jsx("svg",{height:"1em",viewBox:"0 0 14 14",width:"1em",children:c.jsx("polygon",{fill:"currentColor",points:"5.5 11.9993304 14 3.49933039 12.5 2 5.5 8.99933039 1.5 4.9968652 0 6.49933039"})}),oe=P(({className:u,children:m,contentProps:a,...p},f)=>{var x,d;const{buttonRef:I,focusedIndex:t,menuRef:C,setFocusedIndex:o,styles:v,onClose:M}=H(),i=ke(),S=(x=i.value(t))==null?void 0:x.node.id,h=e.useCallback(()=>{const n=i.enabledNextValue(t);n&&o(n.index)},[i,t,o]),_=e.useCallback(()=>{const n=i.enabledPrevValue(t);n&&o(n.index)},[i,t,o]),y=e.useCallback(()=>{const n=i.enabledFirstValue();n&&o(n.index)},[i,o]),r=e.useCallback(()=>{const n=i.enabledLastValue();n&&o(n.index)},[i,o]),j=e.useCallback(n=>{const w={ArrowDown:t===-1?y:h,ArrowUp:t===-1?r:_,End:r,Escape:M,Home:y,Tab:M}[n.key];w&&(n.preventDefault(),w(n))},[t,M,y,r,h,_]);return c.jsx(le,{as:"div",className:"ui-menu__content","aria-activedescendant":S,"aria-labelledby":(d=I.current)==null?void 0:d.id,role:"menu",__css:{...v.content},...a,onKeyDown:N(a==null?void 0:a.onKeyDown,j),children:c.jsx(T.div,{ref:ne(C,f),className:K("ui-menu__list",u),tabIndex:-1,__css:{...v.list},...p,children:m})})});oe.displayName="MenuList";oe.__ui__="MenuList";export{Ve as C,z as M,H as a,je as b,oe as c,X as d,he as e,se as f,te as u};
