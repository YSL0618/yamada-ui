import{j as r}from"./extends-CwFRzn3r.js";import{u as $}from"./index-Dbjktjet.js";import{r as e}from"./index-BwDkhjyp.js";import{P as ee,b as ne}from"./popover-trigger-C4B9Wa4t.js";import{a as te}from"./use-component-style-DhRiPQIp.js";import{o as se}from"./theme-provider-Cr3m0r8P.js";import{p as V,f as J,W as oe,_ as Q,a as X,h as g,am as re,b as E,c as U,w as ce,ap as ae}from"./factory-DBrfn43w.js";import{u as ue}from"./index-BD-dMYlD.js";import{f as L}from"./forward-ref-BWI-Phbn.js";import{c as le}from"./index-ByFQ-olM.js";const{DescendantsContextProvider:ie,useDescendant:fe,useDescendants:me,useDescendantsContext:de}=le(),[xe,q]=V({name:"MenuContext",errorMessage:`useMenu returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />"`}),[Se,pe]=V({name:"ContextMenuContext",strict:!1}),[Ce,Me]=V({name:"UpstreamMenuContext",strict:!1}),[ve,Y]=V({name:"UpstreamMenuItemContext",strict:!1}),Ee=a=>{const{styles:o}=pe()??{},[u,f]=te("Menu",a,{isProcessSkip:!!o,styles:o});let{closeOnBlur:l,closeOnSelect:p=!0,duration:m=.2,initialFocusRef:d,offset:x,placement:k,onClose:y,onOpen:c,...F}=se(f);const{relatedRef:h,onDownstreamCloseMapRef:C,onUpstreamClose:i}=Me()??{},{hasDownstreamRef:_,setDownstreamOpen:v}=Y()??{},n=!!h;n?(k??(k="right-start"),x??(x=[-8,8]),l??(l=!1)):k??(k="bottom-start");const R=me(),[I,b]=e.useState(-1),j=e.useRef(null),N=e.useRef(null),M=e.useRef(new Set([])),B=e.useRef(null),T=e.useRef(new Map),K=e.useCallback(()=>{requestAnimationFrame(()=>{var t;return(t=j.current)==null?void 0:t.focus({preventScroll:!1})})},[]),O=e.useCallback(()=>{const t=setTimeout(()=>{if(d)return;const s=R.enabledFirstValue();s&&b(s.index)});M.current.add(t)},[R,d]),H=e.useCallback(()=>{const t=setTimeout(()=>{if(d)return;const s=R.enabledLastValue();s&&b(s.index)});M.current.add(t)},[R,d]),W=e.useCallback(()=>{c==null||c(),n||K()},[c,n,K]),z=e.useCallback(()=>{y==null||y();for(const t of T.current.values())t()},[y]),A=e.useId(),{isOpen:w,onClose:D,onOpen:P}=$({...a,onClose:z,onOpen:W});return e.useEffect(()=>{const t=C==null?void 0:C.current;return t==null||t.set(A,D),()=>{t==null||t.delete(A)}},[A,D,C]),e.useEffect(()=>{v&&v(w)},[v,w]),e.useEffect(()=>(_&&(_.current=!0),()=>{_&&(_.current=!1)})),J(()=>{w||b(-1)},[w]),oe(()=>{M.current.forEach(t=>clearTimeout(t)),M.current.clear()}),r.jsx(ie,{value:R,children:r.jsx(Ce,{value:{relatedRef:j,onDownstreamCloseMapRef:T,onUpstreamClose:Q(i,D)},children:r.jsx(xe,{value:{buttonRef:N,closeOnSelect:p,focusedIndex:I,isNested:n,isOpen:w,menuRef:j,requestAnimationFrameId:B,setFocusedIndex:b,styles:u,onClose:D,onFocusFirstItem:O,onFocusLastItem:H,onOpen:P,onUpstreamClose:i},children:r.jsx(ee,{trigger:n?"hover":"click",...F,closeOnBlur:l,closeOnButton:!1,duration:m,initialFocusRef:d,isOpen:w,offset:x,placement:k,relatedRef:h,onClose:D,onOpen:P})})})})},be=a=>{var o;return ae(a)&&!!((o=a.getAttribute("role"))!=null&&o.startsWith("menuitem"))},he=L(({className:a,children:o,closeOnSelect:u,command:f,icon:l,isDisabled:p,isFocusable:m,...d},x)=>{const{closeOnSelect:k,focusedIndex:y,isNested:c,isOpen:F,menuRef:h,requestAnimationFrameId:C,setFocusedIndex:i,styles:_,onClose:v,onUpstreamClose:n}=q(),{onUpstreamRestoreFocus:R}=Y()??{},I=p&&!m,b=e.useRef(null),j=e.useRef(!1),N=e.useRef(()=>{}),{index:M,register:B}=fe({disabled:I}),[T,K]=e.useState(!1),O=M===y,H=e.useCallback(()=>{p||i(M)},[M,p,i]),W=e.useCallback(()=>{p||i(-1)},[i,p]),z=e.useCallback(s=>{if(!be(s.currentTarget))return;const S=j.current;(u??(!S&&k))&&(v(),n==null||n())},[u,k,v,n]),A=e.useCallback(()=>{i(M)},[i,M]),w=e.useCallback(()=>{var s;(s=b.current)==null||s.focus(),i(M)},[i,M]),D=e.useCallback(s=>{const G={ArrowLeft:c?Q(R,v):void 0}[s.key];G&&(s.preventDefault(),s.stopPropagation(),G())},[R,v,c]),P=ue({focusOnClick:!1,...d,ref:X(B,b,x),isDisabled:p,isFocusable:m,onClick:g(d.onClick,z),onFocus:g(d.onFocus,A),onKeyDown:g(d.onKeyDown,D,N.current),onMouseLeave:g(d.onMouseLeave,W),onMouseOver:g(d.onMouseOver,H)});J(()=>{if(!F)return;const s=C.current;return O&&!I&&b.current?(s&&cancelAnimationFrame(s),C.current=requestAnimationFrame(()=>{var S;(S=b.current)==null||S.focus({preventScroll:!0}),C.current=null})):h.current&&!re(h.current)&&h.current.focus({preventScroll:!0}),()=>{s&&cancelAnimationFrame(s)}},[O,I,h,F]),o=l||f?r.jsx(E.span,{style:{flex:1},children:o}):o;const t={alignItems:"center",color:"inherit",display:"flex",flex:"0 0 auto",gap:"0.75rem",outline:0,textAlign:"start",textDecoration:"none",userSelect:"none",width:"100%",..._.item};return r.jsx(ve,{value:{hasDownstreamRef:j,setDownstreamOpen:K,onKeyDownRef:N,onUpstreamRestoreFocus:w},children:r.jsxs(E.div,{...P,...T?{"data-active":""}:{},className:U("ui-menu__item",a),role:"menuitem",tabIndex:O?0:-1,__css:t,children:[l?r.jsx(Z,{children:l}):null,o,f?r.jsx(ke,{children:f}):null]})})}),Ue=L(({className:a,children:o,closeOnSelect:u=!1,icon:f,isChecked:l,...p},m)=>r.jsxs(he,{ref:m,className:U("ui-menu__item--option",a),"aria-checked":ce(l),closeOnSelect:u,...p,children:[f!==null?r.jsx(Z,{opacity:l?1:0,children:f||r.jsx(ye,{})}):null,o]})),Z=L(({className:a,...o},u)=>{const{styles:f}=q(),l={alignItems:"center",display:"inline-flex",flexShrink:0,fontSize:"0.85em",justifyContent:"center",...f.icon};return r.jsx(E.span,{ref:u,className:U("ui-menu__item__icon",a),"aria-hidden":!0,__css:l,...o})}),ke=L(({className:a,...o},u)=>{const{styles:f}=q(),l={...f.command};return r.jsx(E.span,{ref:u,className:U("ui-menu__item__command",a),__css:l,...o})}),ye=()=>r.jsx("svg",{height:"1em",viewBox:"0 0 14 14",width:"1em",children:r.jsx("polygon",{fill:"currentColor",points:"5.5 11.9993304 14 3.49933039 12.5 2 5.5 8.99933039 1.5 4.9968652 0 6.49933039"})}),Le=L(({className:a,children:o,contentProps:u,...f},l)=>{var v;const{buttonRef:p,focusedIndex:m,menuRef:d,setFocusedIndex:x,styles:k,onClose:y}=q(),c=de(),F=e.useCallback(()=>{const n=c.enabledNextValue(m);n&&x(n.index)},[c,m,x]),h=e.useCallback(()=>{const n=c.enabledPrevValue(m);n&&x(n.index)},[c,m,x]),C=e.useCallback(()=>{const n=c.enabledFirstValue();n&&x(n.index)},[c,x]),i=e.useCallback(()=>{const n=c.enabledLastValue();n&&x(n.index)},[c,x]),_=e.useCallback(n=>{const I={ArrowDown:m===-1?C:F,ArrowUp:m===-1?i:h,End:i,Escape:y,Home:C,Tab:b=>b.preventDefault()}[n.key];I&&(n.preventDefault(),I(n))},[m,y,C,i,F,h]);return r.jsx(ne,{as:"div",className:"ui-menu__content",__css:{...k.content},...u,onKeyDown:g(u==null?void 0:u.onKeyDown,_),children:r.jsx(E.div,{ref:X(d,l),className:U("ui-menu__list",a),"aria-labelledby":(v=p.current)==null?void 0:v.id,role:"menu",tabIndex:-1,__css:{...k.list},...f,children:o})})});export{Se as C,Z as M,q as a,Ee as b,Le as c,he as d,pe as e,Ue as f,Y as u};
