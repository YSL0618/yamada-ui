import{r as c}from"./index-ClcD9ViR.js";import{k as z,Y as A,e as F,H as P}from"./factory-CehSyZ2b.js";const W=(r,n)=>{const t=getComputedStyle(r);return["auto","overlay","scroll"].includes(t.overflow)?!0:n?["auto","overlay","scroll"].includes(t.overflowY):["auto","overlay","scroll"].includes(t.overflowX)},k=({behavior:r,position:n,reverse:t,root:a,vertical:v})=>{let m;const p=P(a)&&W(a,v)?a:document.body;v?m={behavior:r,top:n??(t?p.scrollHeight:0)}:m={behavior:r,left:n??(t?p.scrollWidth:0)},p===document.body?window.scrollTo(m):p.scrollTo(m)},D=(r,n)=>{const t=P(r)&&W(r,n)?r:document.body;return n?t.scrollHeight-t.scrollTop:t.scrollWidth-t.scrollLeft},K=({behavior:r,disabled:n,indexRef:t,initialLoad:a=!1,isDisabled:v=!1,isReverse:m=!1,orientation:p="vertical",resetRef:Y,reverse:o,rootMargin:C,rootRef:s,startIndex:L=a?0:1,threshold:T,onLoad:U}={})=>{n??(n=v),o??(o=m);const w=c.useRef(null),b=c.useRef(L),y=c.useRef(!1),S=c.useRef(void 0),h=c.useRef(!1),B=c.useRef(0),[X,E]=c.useState(!1),g=z(U),f=p==="vertical",O=c.useMemo(()=>({root:s==null?void 0:s.current,rootMargin:C,threshold:T}),[C,s,T]),j=c.useCallback((l=1,e=!0)=>{if(b.current=l,E(!1),e){const i=s==null?void 0:s.current;k({behavior:r,reverse:o,root:i,vertical:f})}n||setTimeout(()=>{const i=S.current,u=w.current;u&&(i==null||i.observe(u))})},[n,o,s,f,r]),x=c.useCallback(()=>{const l=S.current,e=w.current;e&&(l==null||l.unobserve(e)),E(!0)},[]),H=c.useCallback(()=>new IntersectionObserver(async([e])=>{if(!(e!=null&&e.isIntersecting)||y.current)return;const i={entry:e,finish:x,index:b.current};y.current=!0;const u=s==null?void 0:s.current;if(u&&(u.ariaBusy="true"),o&&(B.current=D(u,f)),await g(i),o){const d=B.current;k({position:d,root:u,vertical:f})}b.current+=1,y.current=!1,u&&(u.ariaBusy="false")},O),[x,g,O,s,o,f]);return c.useEffect(()=>{(async()=>{const e=w.current,i=h.current,u=b.current,d=s==null?void 0:s.current;if(a&&!i&&(y.current=!0,d&&(d.ariaBusy="true"),await g({finish:x,index:u}),b.current+=1,y.current=!1,d&&(d.ariaBusy="false")),n)return;S.current=H();const I=S.current;if(o&&!i){const q=s==null?void 0:s.current;k({reverse:o,root:q,vertical:f}),h.current=!0}return setTimeout(()=>{e&&I.observe(e)}),()=>{e&&I.unobserve(e)}})()},[H,a,n,o,f,x,g,s]),A(()=>h.current=!1),F(Y,j),F(t,l=>b.current=l),{ref:w,finish:X}};export{K as u};
